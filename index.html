<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MP4 Converter</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 5px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .btn {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .download-button {
            display: inline-block;
            background-color: #008CBA;
            color: white;
            padding: 10px 15px;
            text-decoration: none;
            border-radius: 4px;
            margin-top: 10px;
        }
        #progressBar {
            width: 100%;
            background-color: #f1f1f1;
            display: none;
            height: 30px;
            margin-top: 10px;
        }
        #progressBarFill {
            height: 100%;
            width: 0%;
            background-color: #4CAF50;
            text-align: center;
            line-height: 30px;
            color: white;
        }
    </style>
    <!-- Add FFmpeg.wasm libraries -->
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
    <script src="https://unpkg.com/@ffmpeg/core@0.11.0/dist/ffmpeg-core.js"></script>
</head>
<body>
    <div class="container">
        <h1>MP4 Converter</h1>
        <p>Convert your video files to MP4 format with custom bitrate</p>
        
        <div class="form-group">
            <label for="videoFile">Select video file:</label>
            <input type="file" id="videoFile" accept="video/*">
        </div>
        
        <div class="form-group">
            <label for="bitrate">Audio Bitrate (kbps):</label>
            <input type="number" id="bitrate" value="128" min="32" max="320">
        </div>
        
        <button class="btn" onclick="startConversion()">Convert to MP4</button>
        
        <div id="conversionStatus"></div>
        
        <div id="progressBar">
            <div id="progressBarFill">0%</div>
        </div>
        
        <div id="downloadContainer"></div>
    </div>

    <script>
        const { createFFmpeg, fetchFile } = FFmpeg;
        const ffmpeg = createFFmpeg({ log: true });

        async function startConversion() {
            const videoFile = document.getElementById('videoFile').files[0];
            const bitrate = document.getElementById('bitrate').value;
            const conversionStatus = document.getElementById('conversionStatus');
            const progressBar = document.getElementById('progressBar');
            const progressBarFill = document.getElementById('progressBarFill');
            const downloadContainer = document.getElementById('downloadContainer');

            if (!videoFile) {
                alert('Please select a video file');
                return;
            }

            conversionStatus.innerHTML = 'Loading FFmpeg.wasm core...';
            await ffmpeg.load();

            conversionStatus.innerHTML = 'Converting video...';
            progressBar.style.display = 'block';

            // Write the input file to the FS
            ffmpeg.FS('writeFile', videoFile.name, await fetchFile(videoFile));

            // Run the FFmpeg command
            ffmpeg.setProgress(({ ratio }) => {
                const percent = Math.round(ratio * 100);
                progressBarFill.style.width = `${percent}%`;
                progressBarFill.innerHTML = `${percent}%`;
            });

            await ffmpeg.run('-i', videoFile.name, '-b:a', `${bitrate}k`, 'output.mp4');

            // Clean up the FS
            // ffmpeg.FS('unlink', videoFile.name);

            conversionStatus.innerHTML = 'Conversion finished!';

            // Create a download link
            const downloadLink = document.createElement('a');
            downloadLink.href = URL.createObjectURL(new Blob([ffmpeg.FS('readFile', 'output.mp4')]));
            downloadLink.download = 'converted_video.mp4';
            downloadLink.className = 'download-button';
            downloadLink.innerHTML = 'Download MP4';

            // Clear previous download link
            downloadContainer.innerHTML = '';
            downloadContainer.appendChild(downloadLink);
        }
    </script>
</body>
</html>
